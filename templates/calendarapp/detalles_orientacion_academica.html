{% extends 'base/base.html' %}
{% load static %}

{% block title %} {{ title }} {% endblock title %}

{% block breadcrumb %}
{% endblock breadcrumb %}

{% block content %}

<div class="card card-primary">
    <div class="card-header">
        <h3 class="card-title">
            <i class="bi bi-search"></i>
            {{ title }}
        </h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-lg-7">
                <div class="card card-secondary">
                    <div class="card-header">
                        <h3 class="card-title"><i class="bi bi-person-rolodex"></i> Datos de la Orientación Académica
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="label texto-destacado">Facultad: </label>
                            {{ orientacion_academica.id_orientacion_academica.id_facultad }}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Departamento: </label>
                            {{ orientacion_academica.id_orientacion_academica.id_departamento.descripcion_departamento }}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado" >Estado:</label>
                            {{ orientacion_academica.id_orientacion_academica.id_estado_actividad_academica.descripcion_estado_actividad_academica }}
                        </div>
                        <div class="form-group">
                            <label class="label texto-destacado" >Convocatoria:</label>
                            {{ orientacion_academica.id_orientacion_academica.id_convocatoria.id_semestre.descripcion_semestre|add:' '|title}}{{ orientacion_academica.id_orientacion_academica.id_convocatoria.anho|title }}
                        </div>
                        <div class="form-group">
                            <label class="label texto-destacado" >Encargado:</label>
                            {{ orientacion_academica.id_orientacion_academica.id_funcionario_docente_encargado.nombre|add:' '|title}}{{ orientacion_academica.id_orientacion_academica.id_funcionario_docente_encargado|title }} 
                        </div>

                        <div class="form-group">
                        <label class="label texto-destacado">Solicitante:</label>
                            {% if orientacion_academica.id_orientacion_academica.id_persona_alta %}
                                {{ orientacion_academica.id_orientacion_academica.id_persona_alta.nombre|add:' '|title}}{{ orientacion_academica.id_orientacion_academica.id_persona_alta.apellido|title }} 
                            {% else %}
                                ----------
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Fecha de alta:</label>
                            {{ orientacion_academica.id_orientacion_academica.datetime_registro|date:"d/m/Y" }}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado" >Fecha estimada:</label>

                            {% if orientacion_academica.id_orientacion_academica.datetime_inicio_estimado %}
                                {{ orientacion_academica.id_orientacion_academica.datetime_inicio_estimado|date:"d/m/Y"|add:' ' }}{{ orientacion_academica.id_orientacion_academica.datetime_inicio_estimado|time:"H:i"|add:' - ' }}{{ orientacion_academica.id_orientacion_academica.datetime_fin_estimado|time:"H:i" }}
                            {% else %}
                                ----------
                            {% endif %} 
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Fecha real:</label>
                            {% if orientacion_academica.id_orientacion_academica.datetime_fin_real %}
                            {{ orientacion_academica.id_orientacion_academica.datetime_inicio_real|date:"d/m/Y"|add:' ' }}{{ orientacion_academica.id_orientacion_academica.datetime_inicio_real|time:"H:i"|add:' - ' }}{{ orientacion_academica.id_orientacion_academica.datetime_fin_real|time:"H:i" }}
                            {% else %}
                                ----------
                            {% endif %} 

                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado" >Materia:</label>
                            {% if orientacion_academica.id_orientacion_academica.id_materia %}
                                {{ orientacion_academica.id_orientacion_academica.id_materia.descripcion_materia|title}}
                            {% else %}
                                ----------
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label class="label texto-destacado">Nro. Curso: </label>
                                {% if orientacion_academica.id_orientacion_academica.nro_curso %}
                                    {{ orientacion_academica.id_orientacion_academica.nro_curso|title}}
                                {% else %}
                                    ----------
                                {% endif %}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Observación:</label>
                            {% if orientacion_academica.id_orientacion_academica.observacion %}
                                {{ orientacion_academica.id_orientacion_academica.observacion|title}}
                            {% else %}
                                ----------
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Tipo Orientación Académica: </label>
                                {{ orientacion_academica.id_tipo_orientacion_academica.descripcion_tipo_orientacion_academica|title}}
                        </div>

                        <div class="form-group">
                            <label class="label texto-destacado">Motivo:</label>
                                {{ orientacion_academica.id_motivo.descripcion_motivo }}
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-lg-5">
                <div class="card card-secondary">
                    <div class="card-header">
                        <h3 class="card-title"><i class="bi bi-people"></i> Participantes adicionales</h3>
                    </div>
                    <div class="card-body">
                        
                        <table class="table table-bordered" id="tblParticipantes">
                            <thead>
                            <tr>
                                <th>Participante</th>
                                <th>Documento</th>
                            </tr>
                            </thead>
                            <tbody>
                                {% if participantes.exists %}
                                    {% for event in participantes %}
                                        <tr role="row" class="odd">
                                            <td>{{ event.id_participante.nombre|title|add:' ' }}{{ event.id_participante.apellido|title }} </td> 
                                            <td> {{ event.id_participante.documento }} </td> 
                                        </tr>
                                    {% endfor %}
                                {% endif %}
                            </tbody>
                        </table>
                        {% if participantes.exists == False %}
                            <label> Sin participantes... </label> 
                        {% endif %} 
                    </div>
                </div>
            </div>

            <div class="col-lg-12">
                <div class="card card-secondary">
                    <div class="card-header">
                        <h3 class="card-title"><i class="bi bi-journal-text"></i> Tareas</h3>
                    </div>
                    <div class="card-body">
                        
                        <table class="table table-bordered" id="tblParticipantes">
                            <thead>
                            <tr>
                                <th>Inicio</th>
                                <th>Vencimiento</th>
                                <th>Responsable</th>
                                <th>Tipo Tarea</th>
                                <th>Estado</th>
                                <th>Finalizado por</th>
                                <th>Ultima modificación</th>
                                <th>Observación</th>
                            </tr>
                            </thead>
                            <tbody>
                                {% if tareas.exists %}
                                    {% for tarea in tareas %}
                                        <tr role="row" class="odd">
                                            <td>
                                                {% if tarea.datetime_inicio_real %}
                                                    {{ tarea.datetime_inicio_real|date:"d/m/Y"|add:' ' }}{{ tarea.datetime_inicio_real|time:"H:i" }}
                                                {% else %}
                                                    {{ tarea.datetime_inicio_estimado|date:"d/m/Y"|add:' ' }}{{ tarea.datetime_inicio_estimado|time:"H:i" }}
                                                {% endif %}
                                            </td>

                                            <td>
                                                {% if tarea.datetime_finalizacion %}
                                                    {{ tarea.datetime_finalizacion|date:"d/m/Y"|add:' ' }}{{ tarea.datetime_finalizacion|time:"H:i" }}
                                                {% else %}
                                                    {{ tarea.datetime_vencimiento|date:"d/m/Y"|add:' ' }}{{ tarea.datetime_vencimiento|time:"H:i" }}
                                                {% endif %}
                                            </td>
                                            <td>  {{ tarea.id_persona_responsable.nombre|add:' '|title}}{{ tarea.id_persona_responsable.apellido|title }}  </td> 
                                            <td>  {{ tarea.id_tipo_tarea.descripcion_tipo_tarea|title}}  </td> 
                                            <td>  {{ tarea.id_estado_tarea.descripcion_estado_tarea|title}}  </td>
                                            <td> 
                                                {% if tarea.id_persona_finalizacion %}
                                                    {{ tarea.id_persona_finalizacion.nombre|add:' '|title}}{{ tarea.id_persona_finalizacion.apellido|title }} 
                                                {% else %}
                                                    ---------
                                                {% endif %}
                                            </td>
                                            <td>  {{ tarea.datetime_ultima_modificacion|date:"d/m/Y"|add:' ' }}{{ tarea.datetime_ultima_modificacion|time:"H:i" }}  </td>
                                            <td>  {{ tarea.observacion }}  </td> 
                                        </tr>
                                    {% endfor %}
                                {% endif %}
                            </tbody>
                        </table>
                        {% if tareas.exists == False %}
                            <label> Sin Tareas... </label> 
                        {% endif %} 
                    </div>
                </div>
            </div>

        </div>
    </div>

    {% if orientacion_academica.id_orientacion_academica.id_estado_actividad_academica.descripcion_estado_actividad_academica == 'Iniciada' %}
        <div class="card-footer">
            <button type="button" class="btn btn-danger btn-flat" hx-target="#dialog" title="Cancelar" hx-get="{% url 'calendarapp:cancelar_actividad_academica' id_tutoria=0 id_ori_academ=orientacion_academica.id_orientacion_academica %}" > <i class="bi bi-x-lg"></i> Cancelar Orientación Académica </button> 
            <button type="button" class="btn btn-primary btn-flat" hx-target="#dialog" title="Finalizar" hx-get="{% url 'calendarapp:finalizar_actividad_academica' id_tutoria=0 id_ori_academ=orientacion_academica.id_orientacion_academica %}"> <i class="bi bi-check-lg"></i> Finalizar Orientación Académica </button> 
            <button type="button" class="btn btn-primary btn-flat" hx-target="#dialog" title="Editar" > <i class="bi bi-pencil"></i> Editar Orientación Académica </button>
        </div>
    {% endif %}

   
</div>

{% endblock content %}

{% block extrascripts %}
    <script type="text/javascript" src="{% static 'js/plugins/jquery.dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/plugins/dataTables.bootstrap.min.js' %}"></script>
    <script type="text/javascript">$('#sampleTable').DataTable({
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.5/i18n/es-ES.json',
        },
    });</script>
{% endblock extrascripts %}
